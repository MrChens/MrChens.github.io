<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="#前言:  项目需求：在iPhone上通过触摸和手势来操作远程的鼠标。iOS中事件分为3种：触控事件（Touch Event）（单点、多点触控以及手势）传感器事件（Motion Event）（重力、加速器等）远程控制事件（Remote-Control Event）（远程遥控iOS设备多媒体播放等）">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="触摸事件和UIResponder">
<meta property="og:url" content="https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/index.html">
<meta property="og:site_name" content="DeafChen">
<meta property="og:description" content="#前言:  项目需求：在iPhone上通过触摸和手势来操作远程的鼠标。iOS中事件分为3种：触控事件（Touch Event）（单点、多点触控以及手势）传感器事件（Motion Event）（重力、加速器等）远程控制事件（Remote-Control Event）（远程遥控iOS设备多媒体播放等）">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/iOS_responder_chain_2x.png">
<meta property="og:image" content="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/hit_testing_2x.png">
<meta property="og:updated_time" content="2016-12-27T14:59:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="触摸事件和UIResponder">
<meta name="twitter:description" content="#前言:  项目需求：在iPhone上通过触摸和手势来操作远程的鼠标。iOS中事件分为3种：触控事件（Touch Event）（单点、多点触控以及手势）传感器事件（Motion Event）（重力、加速器等）远程控制事件（Remote-Control Event）（远程遥控iOS设备多媒体播放等）">
<meta name="twitter:image" content="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/iOS_responder_chain_2x.png">






  <link rel="canonical" href="https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>触摸事件和UIResponder | DeafChen</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112744328-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112744328-1');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2250627e2fe66049584e97edac149bb6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DeafChen</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Yesterday once more</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/aboutme/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags<span class="badge">10</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories<span class="badge">8</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives<span class="badge">33</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">
      <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />Sitemap</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DeafChen">
      <meta itemprop="description" content="It’s amazing how the unexpected, can take your life and change directions.">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DeafChen">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">触摸事件和UIResponder
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-08-16 20:57:06" itemprop="dateCreated datePublished" datetime="2015-08-16T20:57:06+08:00">2015-08-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2016-12-27 22:59:06" itemprop="dateModified" datetime="2016-12-27T22:59:06+08:00">2016-12-27</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书笔记-ReadingNote/" itemprop="url" rel="index"><span itemprop="name">读书笔记(ReadingNote)</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/16/touch-events-and-uiresponder/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/16/touch-events-and-uiresponder/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2015/08/16/touch-events-and-uiresponder/" class="leancloud_visitors" data-flag-title="触摸事件和UIResponder">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views: </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>#<code>前言:</code></p>
<blockquote>
<p>项目需求：在iPhone上通过触摸和手势来操作远程的鼠标。<br>iOS中事件分为3种：<br>触控事件（Touch Event）（单点、多点触控以及手势）<br>传感器事件（Motion Event）（重力、加速器等）<br>远程控制事件（Remote-Control Event）（远程遥控iOS设备多媒体播放等）</p>
</blockquote>
<a id="more"></a>
<p>参考链接:<br><a href="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/event_delivery_responder_chain/event_delivery_responder_chain.html#//apple_ref/doc/uid/TP40009541-CH4-SW2" target="_blank" rel="noopener">https://developer.apple.com</a></p>
<ul>
<li>触摸事件（触屏事件）</li>
</ul>
<p>因为UIView是UIResponder的子类，所以可以覆盖以下4个方法，来处理4中不同的触摸事件。</p>
<pre><code>- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event; (1或者多根手指开始触摸屏幕)
- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event; (1或者多根手指在屏幕中移动，相关的对象会持续发送该消息)
- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event; (1或者多根手指离开屏幕)
- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event; (在触摸正常结束前，某个系统事件发生了，打断触摸事件)
</code></pre><p>当系统检测到触摸事件时，会创建UITouch对象（一根手指的触摸事件对应一个UITouch对象）。发生触摸事件的UIView对象会收到<code>touchesBegan: withEvent:</code>。系统给你的第一个参数touches（NSSet对象）并、包含了所有相关的UITouch对象。    </p>
<p>当手指在屏幕上移动时，系统更新对应的UITouch对象，会把手指在屏幕上的位置更新到对应的UITouch中。最初发生触摸事件的UIView会收到<code>touchesMoved: withEvent:</code>消息。    </p>
<p>当手指离开屏幕时，系统会最后一次更新相应的UITouch对象，比如对应手指在屏幕上的位置。接着，最初发生该触摸事件的视图会收到<code>touchesEnded: withEvent:</code>消息。当收到该消息的视图执行完touchesEnded:withEvent:后，系统会释放和当前事件有关的UITouch对象。</p>
<p>下面对<code>UITouch</code>对象和事件响应方法的工作机制做一个小归纳。    </p>
<ol>
<li><p>一个<code>UITouch</code>对象对应屏幕上的一根手指。只要手指没有离开屏幕，对应的UITouch对象就会一直存在。这些<code>UITouch</code>对象都会保存对应的手指在屏幕上的当前位置。</p>
</li>
<li><p>在触摸事件持续的过程中，最初发生触摸事件的那个视图都会在各个阶段收到相应的触摸事件消息。即使手指在移动时离开了这个视图的frame区域，系统还是会向该视图发送<code>touchesMoved:withEvent:</code>消息和<code>touchesEnded:withEvent:</code>消息。换句话说就是，当一个视图发生触摸事件后，该视图将一直拥有当时创建的所有UITouch对象。（编写代码时不需要也不应该保留任何UITouch对象）</p>
</li>
<li>当多根手指在同一个视图、同一个时刻，执行相同的触摸动作时，UIApplication实例会使用单个消息、一次分发所有相关的UITouch对象。该实例在发送特定的UIResponder消息时，会传入一个NSSet对象，该对象将包含所有相关的UITouch对象（所有手指）。但是，因为UIApplication实例对“同一时刻”的判断标准很严格，所以通常情况下，哪怕一组事件都是在很短的一段时间内发生的，该实例也会发送多个UIResponder消息。分批发送UITouch对象。</li>
</ol>
<ul>
<li>响应者链 (Responder Chain)<br>响应者链就是由一系列的<code>响应者对象</code>构成的一个层次结构。<code>响应者对象</code>：指的是有响应和处理事件能力的对象。它开始于第一个响应者然后结束于application对象。如果第一响应者无法处理事件，它会将事件沿响应者链中的next responder传递。</li>
</ul>
<p>UIResponder是所有响应对象的基类，在UIResponder累中定义了出来上述各种事件的接口。UIApplication、 UIViewController、UIWindow和所有继承自UIView的UIKit类都直接或间接的继承自UIResponder，所以它们的实例都是可以构成响应者链的响应者对象。（note :core animation layers不是响应者对象）</p>
<p>第一响应者是设计为第一个接收事件的。通常，第一响应者是一个view对象。一个对象要成为第一个响应者可以通过做下面的2件事：</p>
<ol>
<li>重写<code>canBecomeFirstResponder</code>方法来返回<code>YES</code>.</li>
<li>并接收<code>becomeFirstResponder</code>消息。如果需要，一个对象可以给他自己发送这个消息。</li>
</ol>
<p>Note: Make sure that your app has established its object graph before assigning an object to be the first responder. For example, you typically call the becomeFirstResponder method in an override of the viewDidAppear: method. If you try to assign the first responder in viewWillAppear:, your object graph is not yet established, so the becomeFirstResponder method returns NO.</p>
<p>Events不仅仅是唯一一个依赖于响应者链的对象。响应者链是可以用到下面的：</p>
<ol>
<li>Touch events 触摸事件：如果hit-test view不能处理触摸事件，该事件将从hit-test view开始沿响应者链传递。</li>
<li>Motion events 运动事件：为了处理shaking－motion事件。第一响应者必须需要实现UIResponder类中<code>motionBegan:withEvent:</code>或者<code>motionEnded:withEvent:</code>方法。</li>
<li>Remote control events 远程控制事件：为了处理远程控制事件，第一响应者必须实现UIResponder类中<code>remoteControlReceivedWithEvent:</code>方法。</li>
<li>Action messages 动作消息：当用户操作有个控件比如button或者switch，然后这个的action的target是nil的时候，这个消息会通过这个控件的视图开始往响应者链传递。</li>
<li>Editing-menu messages 编辑菜单：当用户点击了编辑菜单中的命令时，iOS会通过响应者链来找到一个实现了necessary方法（例如cut:,copy:,and paste:）的对象</li>
<li>Text editing 文本编辑:当用户点击了text field或者一个text view，该view会自动成为第一响应者。默认的，虚拟键盘会出现或者text view会聚焦到编辑区域。如果合适的话，你可以展示一个自定义的输入界面来替代键盘。你也可以增加一个自定义的输入视图给任意一个响应者对象。<br>7.<br>UIKit automatically sets the text field or text view that a user taps to be the first responder; Apps must explicitly set all other first responder objects with the becomeFirstResponder method</li>
</ol>
<p>响应者链按照特殊的传递路径触底。</p>
<p>如果初始对象－既不是hit-test view也不是first responder–没有处理任何事件，UIKit会将事件沿响应者链传递给the bext responder。每一个响应者决定是否想要处理该事件或者是通过调用<code>nextResponder</code>方法来将事件传递给它的next responder。这个过程会一直继续直到一个响应者对象处理该事件或者没有更多其他的响应者。</p>
<p>当iOS检测到一个事件，响应者链便开始序列并传递给一个初始的对象（一般是一个view）。这个初始视图拥有第一个机会来处理一个事件。</p>
<p><img src="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/iOS_responder_chain_2x.png" alt="iOS_responder_chain_2x"></p>
<p>左边的图片的事件通过下面这样子的路径传递：</p>
<ol>
<li>初始视图尝试处理这个事件（或者消息）。如果它不能处理这个事件，便将该事件传递给它的superview，因为这个初始视图不是这个view controller视图层次中最顶层的视图。</li>
<li>这superview尝试处理这个事件。如果它也不能处理该事件，便将事件传递给它的superview，因为它也不是视图层次中最顶层的视图（top most view）。</li>
<li>这个view controller中的topmost view尝试处理该事件，如果它也不能处理该事件，便将该事件传递给它的view controller。</li>
<li>这个view controller尝试处理该事件，如果也不能处理，传递该事件给window。</li>
<li>如果这个window object也不能处理，便将该事件传递给singleton app object。</li>
<li>如果这个app object也不能处理，那么它便会丢弃该事件。</li>
</ol>
<p>右边图片的事件通过稍微的不同的路径传递，但是所有的事件传递路径都是根据下面：</p>
<ol>
<li>一个视图传递一个事件给它的view controller的视图层次直到到达topmost view。</li>
<li>然后这个topmost view传递事件给它的view controller。</li>
<li>这个view controller传递事件到它的topmost view’s superview。（步骤1-3一直重复直到事件到达root view controller）</li>
<li>root view controller传递事件给window对象</li>
<li>window传递事件给app对象。</li>
</ol>
<p>Important: If you implement a custom view to handle remote control events, action messages, shake-motion events with UIKit, or editing-menu messages, don’t forward the event or message to nextResponder directly to send it up the responder chain. Instead, invoke the superclass implementation of the current event handling method and let UIKit handle the traversal of the responder chain for you.</p>
<p>从图中可看出：</p>
<ol>
<li>响应者链通常是由视图(UIView)构成的。</li>
<li>一个视图的下一个响应者是它的视图控制器(UIViewController)(如果有的话)，然后再转给它的父视图(super View)。</li>
<li>视图控制器（如果有的话）的下一个响应者是该视图控制器管理的视图的父视图。</li>
<li>窗口（UIWindow）的内容视图将指向窗口本身作为它的下一个响应者。 <strong>cocoa touch应用不像cocoa应用，它只有一个UIWindow对象，因此整个响应者链要简单一点；</strong></li>
<li>应用（UIApplication）是一个响应者链的终点，它的下一个响应者指向nil，来结束整个循环。</li>
</ol>
<p>－ 事件分发 (Event Delivery)</p>
<p>第一响应者（First responder）指的是当前接受触摸的响应者对象（通常是一个UIView对象），即当前正在与用户交互，它是响应者链的开端。整个响应者链和事件分发的使命都是找出第一响应者。</p>
<p>UIWindow对象以消息的形式将事件发送给第一响应者，使其有机会首先处理事件。如果第一响应者没有进行处理，系统就将事件（通过消息）传递给响应者链中的下一个响应者，看它是否能进行处理。</p>
<p>iOS使用hit-testing 来查找在触摸底下的那个对应的视图。hit-testing检测触摸事件是否在任何有关联的视图的范围内。如果有在范围内，这个视图会递归调用它所有的子视图。在该包含触摸点的视图层次结构中最低的视图（就是最顶层的视图）成为hit-test view。在iOS找到hit-test view后，它会传递触摸事件到这个view来处理。</p>
<p><img src="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/hit_testing_2x.png" alt="hit_testing_2x"></p>
<p>下面结合上图介绍hit-test view的流程，假如用户点击了View E：</p>
<p>1、触摸发生在View A的范围内，所以开始检测A的子视图B和C；</p>
<p>2、触摸不在View B的范围内，但在View C内，所以开始检测C的子视图D和E；</p>
<p>3、触摸不在View D的范围内，但在View E的范围内：</p>
<p>View E是在包含触摸的视图层次中最低的视图（就是最顶层的视图），所以它变成hit－test View；</p>
<p><code>hitTest: withEvent:</code>方法会返回给定的在命中的view（hit test view）的<code>CGPoint</code>和<code>UIEvent</code>。这个<code>hitTest: withEvent:</code>首先调用它本身的<code>pointInside:withEvent:</code>方法。如果这个触摸点传递给<code>hitTest:withEvent:</code>是在这个view的范围内，则<code>pointInside:withEvent:</code>返回<code>YES</code>.然后这个方法会递归调用它的每一个子视图中<code>hitTest:withEvent:</code>返回<code>YES</code>的方法。</p>
<p>如果这个点传递给<code>hitTest:withEvent:</code>是不在这个view的范围内，那么第一个调用<code>pointInside:withEvent:</code>方法会返回<code>NO</code>，然后这个点会被忽略，<code>hitTest:withEvent:</code>返回<code>nil</code>.如果一个子视图返回<code>NO</code>，那么整个的视图层次结构中的该分支会被忽略。以为这个触摸不发生在这个子视图中，因此也不会发生在该子视图的子视图中。意味着在一个子视图的任何点是在它的父视图（superview）以外的是不能接收到触摸事件的，因为触摸点必须是在父视图和子视图的范围内的。当它的子视图的<code>clipsToBounds</code>的属性设置为<code>NO</code>时，这是会发生的。</p>
<p>点击的范围在E内，即E的pointInside:withEvent:返回YES，由于E没有子视图（也可以理解成对E的子视图进行hit-test时返回了nil），因此，E的hitTest:withEvent:会将E返回，再往回回溯，就是C的hitTest:withEvent:返回E—&gt;&gt;A的hitTest:withEvent:返回E。</p>
<p>至此，本次点击事件的第一响应者就通过响应者链的事件分发逻辑成功的找到了。</p>
<p>三、说明</p>
<p>1、如果最终hit-test没有找到第一响应者，或者第一响应者没有处理该事件，则该事件会沿着响应者链向上回溯，如果UIWindow实例和UIApplication实例都不能处理该事件，则该事件会被丢弃；</p>
<p>2、hitTest:withEvent:方法将会忽略隐藏(hidden=YES)的视图，禁止用户操作(userInteractionEnabled=YES)的视图，以及alpha级别小于0.01(alpha&lt;0.01)的视图。如果一个子视图的区域超过父视图的bound区域(父视图的clipsToBounds 属性为NO，这样超过父视图bound区域的子视图内容也会显示)，那么正常情况下对子视图在父视图之外区域的触摸操作不会被识别,因为父视图的pointInside:withEvent:方法会返回NO,这样就不会继续向下遍历子视图了。当然，也可以重写pointInside:withEvent:方法来处理这种情况。</p>
<p>3、我们可以重写hitTest:withEvent:来达到某些特定的目的，下面的链接就是一个有趣的应用举例，当然实际应用中很少用到这些。</p>
<p>参考文档：</p>
<p><a href="https://developer.apple.com/library/ios/#documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/event_delivery_responder_chain/event_delivery_responder_chain.html#//apple_ref/doc/uid/TP40009541-CH4-SW1" target="_blank" rel="noopener">https://developer.apple.com</a><br>事例代码从这里下载<br>[bynomial.com][<a href="http://bynomial.com/blog/?p=74]" target="_blank" rel="noopener">http://bynomial.com/blog/?p=74]</a></p>
<ul>
<li>事件传递</li>
</ul>
<p>iOS中事件传递首先是从UIApplication开始，接着传递到Window，再接着往下传递到View之前，window会将事件交给GestureRecognizer，如果在此期间，GestureRecognizer识别了传递过来的事件，则该事件将不会继续传递到View去，而是交给Target（ViewController）进行处理。</p>

      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechat_qrcode.jpg" alt="DeafChen wechat" style="width: 200px; max-width: 100%;"/>
    <div>扫码关注一个很懒的程序员!</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Winter is coming, give me a penny!</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat_reward.JPG" alt="DeafChen WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay_reward.jpg" alt="DeafChen Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>DeafChen</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/" title="触摸事件和UIResponder">https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/08/08/iphone-accelerometer-and-device-orientation/" rel="next" title="翻译：iPhone的加速计和设备的方向">
                <i class="fa fa-chevron-left"></i> 翻译：iPhone的加速计和设备的方向
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/08/29/view-debugging-in-xcode6/" rel="prev" title="翻译：使用Xcode6的视图调试">
                翻译：使用Xcode6的视图调试 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="DeafChen" />
            
              <p class="site-author-name" itemprop="name">DeafChen</p>
              <p class="site-description motion-element" itemprop="description">It’s amazing how the unexpected, can take your life and change directions.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/MrChens" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/LableTag" target="_blank" title="Twitter" rel="external nofollow"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/325751212" target="_blank" title="Weibo" rel="external nofollow"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DeafChen</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://mrchens.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://mrchens.github.io/2015/08/16/touch-events-and-uiresponder/';
        this.page.identifier = '2015/08/16/touch-events-and-uiresponder/';
        this.page.title = '触摸事件和UIResponder';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://mrchens.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("Rbmck7R3KAm9W7niGDdiqynV-gzGzoHsz", "vkjMmth4lwiUrDQ7gMeA9MkM");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  

  

</body>
</html>
