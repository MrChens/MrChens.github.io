<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/zerlz.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/zerlz.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/zerlz.png?v=6.3.0">


  <link rel="mask-icon" href="/images/zerlz.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.3.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前言放一些在iOS开发中用来提高效率的脚本工具传送门  codeObfuscated 改良版的代码混淆传送门 aUtoReSiGn 是使用企业签名来做ipa包的重签名传送门 inject_with_jailbreaking 用来在越狱设备中hook某些app做些调研什么的传送门 class_dump 对ipa文件进行头文件的导出传送门 B&amp;amp;A&amp;amp;D 构建,打包,并提交Itunesco">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS工具集">
<meta property="og:url" content="https://mrchens.github.io/2017/04/17/iOS-Tools/index.html">
<meta property="og:site_name" content="Zerlz&#39;s blog">
<meta property="og:description" content="前言放一些在iOS开发中用来提高效率的脚本工具传送门  codeObfuscated 改良版的代码混淆传送门 aUtoReSiGn 是使用企业签名来做ipa包的重签名传送门 inject_with_jailbreaking 用来在越狱设备中hook某些app做些调研什么的传送门 class_dump 对ipa文件进行头文件的导出传送门 B&amp;amp;A&amp;amp;D 构建,打包,并提交Itunesco">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://mrchens.github.io/images/article/2017.04/2017-04-17-iOS-Tools-BuildPhase.png">
<meta property="og:image" content="https://github.com/MrChens/iOS_Tools/blob/master/isWKoUI/iswkoui.png">
<meta property="og:image" content="https://github.com/MrChens/iOS_Tools/blob/master/crashMe/sourcecode.png">
<meta property="og:updated_time" content="2018-11-11T15:28:37.528Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS工具集">
<meta name="twitter:description" content="前言放一些在iOS开发中用来提高效率的脚本工具传送门  codeObfuscated 改良版的代码混淆传送门 aUtoReSiGn 是使用企业签名来做ipa包的重签名传送门 inject_with_jailbreaking 用来在越狱设备中hook某些app做些调研什么的传送门 class_dump 对ipa文件进行头文件的导出传送门 B&amp;amp;A&amp;amp;D 构建,打包,并提交Itunesco">
<meta name="twitter:image" content="http://mrchens.github.io/images/article/2017.04/2017-04-17-iOS-Tools-BuildPhase.png">






  <link rel="canonical" href="https://mrchens.github.io/2017/04/17/iOS-Tools/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>iOS工具集 | Zerlz's blog</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112744328-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112744328-1');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2250627e2fe66049584e97edac149bb6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zerlz's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Yesterday once more</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/aboutme/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags<span class="badge">15</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories<span class="badge">9</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives<span class="badge">36</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">
      <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />Sitemap</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mrchens.github.io/2017/04/17/iOS-Tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zerlz">
      <meta itemprop="description" content="It’s amazing how the unexpected, can take your life and change directions.">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zerlz's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">iOS工具集
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 23:26:17" itemprop="dateCreated datePublished" datetime="2017-04-17T23:26:17+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-11-11 23:28:37" itemprop="dateModified" datetime="2018-11-11T23:28:37+08:00">2018-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具-Tools/" itemprop="url" rel="index"><span itemprop="name">工具(Tools)</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/17/iOS-Tools/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/17/iOS-Tools/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/17/iOS-Tools/" class="leancloud_visitors" data-flag-title="iOS工具集">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views: </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><code>前言</code><br>放一些在iOS开发中用来提高效率的脚本工具<a href="https://github.com/MrChens/iOS_Tools" target="_blank" rel="noopener">传送门</a></p>
<ul>
<li><code>codeObfuscated</code> 改良版的代码混淆<a href="https://github.com/MrChens/codeObfuscated" target="_blank" rel="noopener">传送门</a></li>
<li><code>aUtoReSiGn</code> 是使用企业签名来做ipa包的重签名<a href="https://github.com/MrChens/iOS_Tools/tree/master/autoResign" target="_blank" rel="noopener">传送门</a></li>
<li><code>inject_with_jailbreaking</code> 用来在越狱设备中hook某些app做些调研什么的<a href="https://github.com/MrChens/iOS_Tools/tree/master/inject_with_jailbreaking" target="_blank" rel="noopener">传送门</a></li>
<li><code>class_dump</code> 对ipa文件进行头文件的导出<a href="https://github.com/MrChens/iOS_Tools/tree/master/class_dump" target="_blank" rel="noopener">传送门</a></li>
<li><code>B&amp;A&amp;D</code> 构建,打包,并提交Itunesconnect上传dsym文件到svn以供后续Debug使用<a href="https://github.com/MrChens/iOS_Tools/tree/master/B%26A%26D" target="_blank" rel="noopener">传送门</a></li>
<li><code>isWKoUI</code> 检测app内的页面是<code>WKWebview</code>还是<code>UIWebview</code><a href="https://github.com/MrChens/iOS_Tools/tree/master/isWKoUI" target="_blank" rel="noopener">传送门</a></li>
<li><code>crashMe</code> 演示如何通过<code>crash</code>文件排查<code>app</code>崩溃的问题<a href="https://github.com/MrChens/iOS_Tools/tree/master/crashMe" target="_blank" rel="noopener"> 传送门</a></li>
<li><code>nextDay</code> 演示什么叫做永远没空研究系列<a href="https://github.com/MrChens/iOS_Tools/tree/master/nextDay" target="_blank" rel="noopener">传送门</a></li>
</ul>
<a id="more"></a>
<h1 id="codeObfuscated"><a href="#codeObfuscated" class="headerlink" title="codeObfuscated"></a>codeObfuscated</h1><h2 id="本工具是用于混淆方法名和类名"><a href="#本工具是用于混淆方法名和类名" class="headerlink" title="本工具是用于混淆方法名和类名"></a>本工具是用于混淆方法名和类名</h2><ul>
<li>改良这个脚本工具的初衷:因为项目中使用JSPatch的热修复功能，然后上架的时候被Apple拒绝了，然后就有了这个混淆的工具。如果你也需要混淆JSPatch那么你可以复用<code>obfuscation.list</code>,本人已经通过审核了.</li>
</ul>
<blockquote>
<p>使用本脚本做完了混淆后，可以使用github上整理好的上的<a href="https://github.com/MrChens/iOS_Tools/tree/master/class_dump" target="_blank" rel="noopener">class_dump</a>中的工具做.h文件的dump查看混淆的效果.</p>
</blockquote>
<blockquote>
<p>建议:理论上来说能混淆任意的字符串，但是出于实用性<code>obfuscation.list</code>最好不要放置属性名，我只测试过函数名和类名的混淆，如果有兴趣对其他的字符串做混淆请自行测试。</p>
</blockquote>
<p>  该工具是由<a href="http://blog.csdn.net/yiyaaixuexi/article/details/29201699" target="_blank" rel="noopener">念茜的iOS安全攻防（二十三）：Objective-C代码混淆</a>为原型做了以下的修改</p>
<ul>
<li>防止生成的随机数有可能重复的问题</li>
<li><p>防止每次编译程序的时候,<code>codeObfuscation.h</code>文件都会发生变化而导致的每次编译都要很久的问题</p>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤:"></a>使用步骤:</h3></li>
<li>将混淆脚本<code>obfuscated.sh</code>和需要混淆的函数名/类名表<code>obfuscation.list</code>这2个文件放到工程的根目录下.</li>
<li><strong>重要的提示:如果是为了审核通过请不要将<code>obfuscation.list</code>在项目中引用(reference),否则就会和我一样虽然混淆了但是<code>obfuscation.list</code>暴露出了一切还是会被Apple拒绝的,因为你将文件引用入工程会导致它在打包时会将该文件一起打包进去的.</strong></li>
<li>配置<code>Build Phase</code>:在工程<code>Build Phase</code>中添加执行脚本操作，执行<code>obfuscated.sh</code>如图<img src="http://mrchens.github.io/images/article/2017.04/2017-04-17-iOS-Tools-BuildPhase.png" alt="BuildPhase"></li>
<li>在<code>obfuscation.list</code>中写入需要混淆的方法名和类名，如:</li>
</ul>
<pre><code>@interface JPCore : NSObject    //其中JPCore是需要混淆的类名
-(void)sample;  
-(void)seg1:(NSString \*)string seg2:(NSUInteger)num;
就这样写:
JPCore  
sample  
seg1    
seg2
</code></pre><ul>
<li>脚本执行完了以后会生成一个<code>codeObfuscation.h</code>头文件，将此头文件加入工程中并在<code>XXX-Prefix.ch</code>中import</li>
</ul>
<pre><code>#ifdef __OBJC__  
    #import &lt;UIKit/UIKit.h&gt;  
    #import &lt;Foundation/Foundation.h&gt;  
    //添加混淆作用的头文件（这个文件名是脚本obfuscated.sh中定义的）  
    #import &quot;codeObfuscation.h&quot;  
#endif
</code></pre><h1 id="aUtoReSiGn"><a href="#aUtoReSiGn" class="headerlink" title="aUtoReSiGn"></a>aUtoReSiGn</h1><h2 id="1-环境要求"><a href="#1-环境要求" class="headerlink" title="1. 环境要求:"></a>1. 环境要求:</h2><ol>
<li>OSX 10.8以上.</li>
<li>Xcode8.0以上.</li>
</ol>
<h2 id="2-使用方式"><a href="#2-使用方式" class="headerlink" title="2. 使用方式:"></a>2. 使用方式:</h2><ol>
<li>直接在终端运行<code>aUtoReSiGn.sh</code>.</li>
<li>将要需要企业重签名的<code>ipa</code>放入<code>input文件夹</code>中.</li>
<li>企业重签名后的<code>ipa</code>文件会自动放入<code>output文件夹</code>中.</li>
<li>默认情况下重签名的是Distribution版的，如需重签名<code>Development</code>版的请修改<code>resign.config</code>中的<code>GET_TASK_ALLOW</code>为<code>true</code></li>
<li>如若不需要自动重签名，请直接运行<code>resign.sh</code>脚本</li>
</ol>
<h2 id="3-重要的"><a href="#3-重要的" class="headerlink" title="3. 重要的:"></a>3. 重要的:</h2><p>在使用该脚本前您需要确保做了以下几件事:</p>
<p> <strong>P.S.:请看完全文后再配置，后面附有文件的详细获取/修改步骤</strong> Development和Distribution的区别在于Development的重签名是可以<code>get-task-allow</code></p>
<h2 id="3-1-Development配置"><a href="#3-1-Development配置" class="headerlink" title="3.1 Development配置"></a>3.1 Development配置</h2><ul>
<li>配置<code>Development</code>的企业证书在本地的电脑中(钥匙串中)</li>
<li>将您下载的<code>Development</code>版的<code>xx.mobileprovision</code>放入<code>resign</code>目录中并重命名为<code>EnterPrise_Development.mobileprovision</code>,文件结构如下图<code>文件结构</code>所示</li>
<li>修改<code>resign</code>中<code>Entitlements/developer/Entitlements.plist</code>的配置</li>
<li>在<code>resign.config</code>文件中修改<code>CODESIGN_IDENTITIES_DEV</code>的值为您<code>Development</code>版的企业证书名字</li>
</ul>
<h2 id="3-1-Distribution配置"><a href="#3-1-Distribution配置" class="headerlink" title="3.1 Distribution配置"></a>3.1 Distribution配置</h2><ul>
<li>配置<code>Distribution</code>的企业证书在本地的电脑中(钥匙串中)</li>
<li>将您下载的<code>Distribution</code>版的<code>yy.mobileprovision</code>放入<code>resign</code>目录中并重命名为<code>EnterPrise_Distribution.mobileprovision</code>,文件结构如下图<code>文件结构</code>所示</li>
<li>修改<code>resign</code>中<code>Entitlements/production/Entitlements.plist</code>的配置</li>
<li>在<code>resign.config</code>文件中修改<code>CODESIGN_IDENTITIES</code>的值为您<code>Distribution</code>版的企业证书名字</li>
</ul>
<h2 id="3-2-如何修改对应的Entitlements-plist"><a href="#3-2-如何修改对应的Entitlements-plist" class="headerlink" title="3.2 如何修改对应的Entitlements.plist"></a>3.2 如何修改对应的<code>Entitlements.plist</code></h2><ul>
<li>假设你的<code>teamID</code>为:<code>yourTeamID</code></li>
<li>假设你的<code>application-identifier</code>:为<code>yourTeamID.com.xxx.xxx</code></li>
<li>将<code>application-identifier</code>中的<code>yyyy.com.xxx.xxx</code>改为<code>yourTeamID.com.xxx.xxx</code></li>
<li>将<code>keychain-access-groups</code>的中的<code>yyyy.*</code>改为<code>yourTeamID.*</code></li>
</ul>
<p>如果看不懂上面说的是什么鬼.</p>
<ul>
<li><p>Development配置</p>
<ul>
<li>将<code>Entitlements/developer/Entitlements.plist</code>中的<code>application-identifier</code>的值，改为<code>EnterPrise_Development.mobileprovision</code>文件中<code>application-identifier</code>中对应的值</li>
<li>将<code>Entitlements/developer/Entitlements.plist</code>中的<code>keychain-access-groups</code>的值，改为<code>EnterPrise_Development.mobileprovision</code>文件中<code>keychain-access-groups</code>中对应的值</li>
</ul>
</li>
<li><p>Distribution配置</p>
<ul>
<li>将<code>Entitlements/production/Entitlements.plist</code>中的<code>application-identifier</code>的值，改为<code>EnterPrise_Distribution.mobileprovision</code>文件中<code>application-identifier</code>中对应的值</li>
<li>将<code>Entitlements/production/Entitlements.plist</code>中的<code>keychain-access-groups</code>的值，改为<code>EnterPrise_Distribution.mobileprovision</code>文件中<code>keychain-access-groups</code>中对应的值</li>
</ul>
</li>
</ul>
<h2 id="3-3-如何获取对应的xx-mobileprovision"><a href="#3-3-如何获取对应的xx-mobileprovision" class="headerlink" title="3.3 如何获取对应的xx.mobileprovision"></a>3.3 如何获取对应的<code>xx.mobileprovision</code></h2><ul>
<li>Development<ul>
<li>登陆你的企业开发者账号，选择<code>Provisioning Profiles</code>下的<code>Development</code>下载<code>Type</code>为<code>iOS Development</code>的<code>Provisioning Profiles</code>文件(P.S.:没试过<code>Type</code>为<code>iOS UniversalDistribution</code>的)</li>
</ul>
</li>
<li>Distribution<ul>
<li>登陆你的企业开发者账号，选择<code>Provisioning Profiles</code>下的<code>Distribution</code>下载<code>Type</code>为<code>iOS Distribution</code>的<code>Provisioning Profiles</code>文件(P.S.:没试过<code>Type</code>为<code>iOS UniversalDistribution</code>的)</li>
</ul>
</li>
</ul>
<h2 id="3-4-如何获取您证书的名字"><a href="#3-4-如何获取您证书的名字" class="headerlink" title="3.4 如何获取您证书的名字"></a>3.4 如何获取您证书的名字</h2><ul>
<li>Development<ul>
<li>打开电脑中的<code>Keychain Access</code></li>
<li>找到您的<code>Development</code>企业证书，并双击</li>
<li>复制证书<code>Common Name</code>中对应的值到<code>resign.config</code>的<code>CODESIGN_IDENTITIES_DEV</code></li>
</ul>
</li>
<li>Distribution<ul>
<li>打开电脑中的<code>Keychain Access</code></li>
<li>找到您的<code>Distribution</code>企业证书，并双击</li>
<li>复制证书<code>Common Name</code>中对应的值到<code>resign.config</code>的<code>CODESIGN_IDENTITIES</code></li>
</ul>
</li>
</ul>
<h2 id="如果不想使用自动重签名，可以将xx-ipa放在resign目录下-并执行脚本resign-sh"><a href="#如果不想使用自动重签名，可以将xx-ipa放在resign目录下-并执行脚本resign-sh" class="headerlink" title="如果不想使用自动重签名，可以将xx.ipa放在resign目录下,并执行脚本resign.sh"></a>如果不想使用自动重签名，可以将<code>xx.ipa</code>放在<code>resign</code>目录下,并执行脚本<code>resign.sh</code></h2><hr>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构:"></a>文件结构:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">aUtoReSiGn</span><br><span class="line">│   ├── README.md</span><br><span class="line">│   ├── aUtoReSiGn.sh</span><br><span class="line">│   └── resign</span><br><span class="line">│       ├── EnterPrise_Development.mobileprovision</span><br><span class="line">│       ├── EnterPrise_Distribution.mobileprovision</span><br><span class="line">│       ├── Entitlements</span><br><span class="line">│       │   ├── developer</span><br><span class="line">│       │   └── production</span><br><span class="line">│       ├── certificate.png</span><br><span class="line">│       ├── provisioning\ profiles.png</span><br><span class="line">│       ├── resign.config</span><br><span class="line">│       └── resign.sh</span><br></pre></td></tr></table></figure>
<h1 id="inject-with-jailbreaking"><a href="#inject-with-jailbreaking" class="headerlink" title="inject_with_jailbreaking"></a>inject_with_jailbreaking</h1><h2 id="有空的时候补充一下文档，可以先从传送门过去看看"><a href="#有空的时候补充一下文档，可以先从传送门过去看看" class="headerlink" title="有空的时候补充一下文档，可以先从传送门过去看看."></a>有空的时候补充一下文档，可以先从<a href="https://github.com/MrChens/iOS_Tools/tree/master/inject_with_jailbreaking" target="_blank" rel="noopener">传送门</a>过去看看.</h2><h1 id="class-dump"><a href="#class-dump" class="headerlink" title="class_dump"></a>class_dump</h1><h2 id="导出头文件操作流程文档"><a href="#导出头文件操作流程文档" class="headerlink" title="导出头文件操作流程文档"></a>导出头文件操作流程文档</h2><p><a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">class-dump</a></p>
<p><a href="https://github.com/stefanesser/dumpdecrypted.git" target="_blank" rel="noopener">砸壳(破解)工具</a></p>
<h2 id="砸壳时遇见如下"><a href="#砸壳时遇见如下" class="headerlink" title="砸壳时遇见如下"></a>砸壳时遇见如下</h2><pre><code>dyld: could not load inserted library &apos;dumpdecrypted.dylib&apos; because no suitable image found. Did find:
dumpdecrypted.dylib: required code signature missing for &apos;dumpdecrypted.dylib&apos;

security find-identity -v -p codesigning
codesign --force --verify --verbose --sign &quot;iPhone Developer: xxx xxxx (xxxxxxxxxx)&quot; dumpdecrypted.dylib
</code></pre><h2 id="本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。"><a href="#本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。" class="headerlink" title="本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。"></a>本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。</h2><p>从App Store下载的ipa是需要先砸壳然后再使用<code>class-dump</code>才能导出头文件.<br>如果是自己打包的企业app直接把ipa解压后的xx.app用<code>class-dump</code>就能导出头文件.</p>
<h2 id="针对App-Store下载的ipa进行的class-dump-需要越狱的设备"><a href="#针对App-Store下载的ipa进行的class-dump-需要越狱的设备" class="headerlink" title="针对App Store下载的ipa进行的class-dump(需要越狱的设备)"></a>针对App Store下载的ipa进行的<code>class-dump</code>(需要越狱的设备)</h2><ul>
<li>先从ituness上下载xxx.ipa</li>
<li>然后将ipa安装到越狱的手机中</li>
<li>将<code>dumpdecrypted.dylib</code>拷贝到手机的<code>(iOS8)/var/mobile/Containers/Data/Application/xxx-xxx/Documents</code>目录下，在iOS7中是<code>/var/mobile/Applications/xxx-xxx/Documents</code></li>
<li>iOS8然后再cd到3中的目录下执行:<code>DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/xxx-xxx/yyy.app/yyy</code><br>iOS7然后再cd到3中的目录下执行:<code>DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/mobile/Applications/xxx-xxx/yyy.app/yyy</code></li>
<li>然后就会生成<code>yyy.decrypted</code></li>
<li>使用<code>scp</code>将<code>yyy.decrypted</code>传输到电脑上</li>
<li><code>./class-dump -H yyy.decrypted -o outputs</code></li>
<li>然后就能在<code>outputs</code>中看到导出的头文件</li>
</ul>
<h2 id="针对不需要砸壳的ipa进行的class-dump-不需要越狱的设备"><a href="#针对不需要砸壳的ipa进行的class-dump-不需要越狱的设备" class="headerlink" title="针对不需要砸壳的ipa进行的class-dump(不需要越狱的设备)"></a>针对不需要砸壳的ipa进行的class-dump(不需要越狱的设备)</h2><ul>
<li>将xxx.ipa解压到<code>class-dump</code>同个目录下，然后使用下面的命令将头文件导出到<code>outputs</code>目录下:</li>
<li><code>./class-dump -H xx.app -o  outputs</code></li>
<li>然后就能在<code>outputs</code>中看到导出的头文件</li>
</ul>
<h1 id="B-amp-A-amp-D"><a href="#B-amp-A-amp-D" class="headerlink" title="B&amp;A&amp;D"></a>B&amp;A&amp;D</h1><h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求:"></a>环境要求:</h2><ol>
<li>OSX 10.8以上.</li>
<li>Xcode8.0以上.</li>
</ol>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式:"></a>使用方式:</h2><ol>
<li>将<code>exportOptions</code>,<code>build.sh</code>,<code>archive.config</code>放入你项目的根目录</li>
<li>修改<code>build.sh</code>中<code>ARCHIVE_SCHEME_NAME</code>,<code>ARCHIVE_PROJECT_NAME</code>,<code>ApplicationLoader_UserName</code>,<code>ApplicationLoader_Password</code>为你对应的</li>
<li>执行<code>build.sh archive.config</code><br>4.<h1 id="isWKoUI"><a href="#isWKoUI" class="headerlink" title="isWKoUI"></a>isWKoUI</h1><h2 id="如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview"><a href="#如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview" class="headerlink" title="如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview"></a>如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview</h2></li>
</ol>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法:"></a>使用方法:</h2><ol>
<li>使用这里的<a href="https://github.com/MrChens/iOS_Tools/tree/master/autoResign" target="_blank" rel="noopener">传送门</a>脚本对app进行重签名.<ul>
<li>PS:要选择Development的配置来进行重签名</li>
</ul>
</li>
<li>重签名后将app安装到手机并使用闪电转USB连接线连接Mac电脑</li>
<li>打开app到你想要验证的页面</li>
<li>打开Mac电脑上的Safari浏览器</li>
<li>打开Safari菜单栏上的<code>开发</code>选项.如果没找到开发选项，请依次点击<code>Safari浏览器</code>-&gt;<code>偏好设置</code>-&gt;<code>高级</code>-&gt;<code>在菜单栏中显示“开发”菜单</code>将勾勾选中.<ul>
<li>PS:实在不明白请百度：Safari打开开发者选项</li>
</ul>
</li>
<li>然后按如下图操作:<ul>
<li>点击<code>Develop</code>.(PS:中文里面是叫做<code>开发</code>)</li>
<li>选择<code>devmatocloud的iPhone</code>, 这时会有个<code>WSPXDemo</code>下面会显示app内webview加载的网址.(PS:如果没有网址出现在里面，那么该页面并不是webview做的)<ul>
<li><code>devmatocloud的iPhone</code>对应你的手机;<code>WSPXDemo</code>对应你app的名字</li>
</ul>
</li>
<li>选择其中一个网址，会弹出对应的<code>Web Inspector</code>.(PS:中文应该叫web检查器)</li>
<li>然后在<code>Console</code>中输入<code>window.statusbar.visible</code>并按回车键,如果输出<code>true</code>那么就是<code>wkwebview</code>，相反则为<code>uiwebview</code>.</li>
</ul>
</li>
</ol>
<p><img src="https://github.com/MrChens/iOS_Tools/blob/master/isWKoUI/iswkoui.png" alt="传说中的下图"></p>
<h2 id="Trick"><a href="#Trick" class="headerlink" title="Trick"></a>Trick</h2><ul>
<li>一般使用<code>WKWebview</code>都会在native这边通过<code>- (void)addScriptMessageHandler:(id &lt;WKScriptMessageHandler&gt;)scriptMessageHandler name:(NSString *)name;</code>添加一个script消息的handler，那么就可以通过在<code>Web Inspector</code>中输入<code>window.webkit.messageHandlers</code>查看是否有输出对应的输出来判断是哪个<code>webview</code><ul>
<li><code>UIWebview</code>中的输出为:<code>TypeError: undefined is not an object (evaluating &#39;window.webkit.messageHandlers&#39;)</code></li>
<li><code>WKWebview</code>中的输出为:<code>UserMessageHandlersNamespace {}</code></li>
</ul>
</li>
</ul>
<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO:"></a>TODO:</h2><ul>
<li>弄个网址直接弹窗显示检测结果</li>
</ul>
<h1 id="crashMe"><a href="#crashMe" class="headerlink" title="crashMe"></a>crashMe</h1><h2 id="app崩溃时排查步骤"><a href="#app崩溃时排查步骤" class="headerlink" title="app崩溃时排查步骤"></a>app崩溃时排查步骤</h2><blockquote>
<p>在app崩溃时所生成的<code>.crash</code>文件，默认情况下该文件显示的都是十六进制数无法分析。所以我们需要对这些文件进行分析。</p>
</blockquote>
<h2 id="需要的工具"><a href="#需要的工具" class="headerlink" title="需要的工具:"></a>需要的工具:</h2><ul>
<li><code>Xcode</code></li>
<li><code>app</code>崩溃时生成的<code>.crash</code>文件,可通过<code>Xcode</code>–&gt; <code>Window</code>–&gt; <code>Devices and Simulators</code>–&gt; <code>View Device Logs</code>从iPhone中提取出来</li>
<li><code>dsym</code>文件(符号表文件)</li>
<li><code>symbolicatecrash</code>(可通过执行<code>find /Applications/Xcode.app/ -name symbolicatecrash</code>找到该文件的所在位置)</li>
</ul>
<h2 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式:"></a>使用方式:</h2><ol>
<li>打开<code>.crash</code>文件找到其中的<code>uuid</code></li>
<li>找到对应的<code>dysm</code>文件.(可通过<code>dwarfdump --uuid xxx.dsym</code>查看<code>uuid</code>是否和1的一致)</li>
<li>将<code>.crash</code>,<code>dysm</code>,<code>symbolicatecrash</code>这3个文件放在同一个文件夹下方便处理</li>
<li>执行命令<code>./symbolicatecrash xxxx.crash xxxx.dSYM/ &gt; output.crash</code>就可以看到符号化以后的崩溃堆栈信息</li>
<li>若报错<code>Error: &quot;DEVELOPER_DIR&quot; is not defined at ./symbolicatecrash</code>，则在终端执行一次后面的命令<code>export DEVELOPER_DIR=&quot;/Applications/XCode.app/Contents/Developer&quot;</code>，然后再执行一次<code>4</code>的命令.</li>
</ol>
<p>ps:最后生成的<code>.crash</code>文件只会解析当前项目的代码，其余的还是十六进制数据</p>
<h2 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作"></a>实际操作</h2><ol>
<li><p>从<code>iPhone</code>中获取<code>wspxDemo  2018-11-5, 2-42 PM.crash.crash</code>文件如下(只保留需要的关键信息)</p>
<pre><code>Incident Identifier: 211AB31B-F097-47DC-83ED-3AC6B3AC6B05
CrashReporter Key:   991d9b4c57cf7b9c00c2cabc05f20cb4812ea851
Hardware Model:      iPhone10,3
Process:             wspxDemo [1214]
Path:                /private/var/containers/Bundle/Application/DF7AAB28-9FF0-99EC-4EA1-16B5C50EB87C/wspxDemo.app/wspxDemo
Identifier:          com.crash.CrashMe
Version:             2222 (22.22.222)
Code Type:           ARM-64 (Native)
Role:                Foreground
Parent Process:      launchd [1]
Coalition:           com.crash.CrashMe [738]

Date/Time:           2018-11-05 14:42:17.6018 +0800
Launch Time:         2018-11-05 14:42:17.3303 +0800
OS Version:          iPhone OS 12.1 (16B5089b)
Baseband Version:    3.11.00
Report Version:      104

Exception Type:  EXC_CRASH (SIGABRT)
Exception Codes: 0x0000000000000000, 0x0000000000000000
Exception Note:  EXC_CORPSE_NOTIFY
Triggered by Thread:  0

Application Specific Information:
abort() called

Last Exception Backtrace:
(0x1dcfcfea0 0x1dc1a1a40 0x1dcede054 0x102ceb9b4 0x209fda3c8 0x209fdbb30 0x209fe157c 0x20987ea18 0x209887698 0x20987e694 0x20987f034 0x20987d134 0x20987cde0 0x209881fa0 0x209882f00 0x209881e58 0x209886d44 0x209fdfa74 0x209bca088 0x1dfa049d4 0x1dfa0f79c 0x1dfa0ee94 0x1dca0a484 0x1dc9e13f0 0x1dfa43a9c 0x1dfa43728 0x1dfa43d44 0x1dcf601cc 0x1dcf6014c 0x1dcf5fa30 0x1dcf5a8fc 0x1dcf5a1cc 0x1df1d1584 0x209fe3328 0x102cebaf0 0x1dca1abb4)

Thread 0 name:  Dispatch queue: com.apple.main-thread
Thread 0 Crashed:
0   libsystem_kernel.dylib            0x00000001dcb67104 0x1dcb44000 + 143620
1   libsystem_pthread.dylib           0x00000001dcbe6998 0x1dcbe0000 + 27032
2   libsystem_c.dylib                 0x00000001dcabed78 0x1dca67000 + 359800
3   libc++abi.dylib                   0x00000001dc188f78 0x1dc187000 + 8056
4   libc++abi.dylib                   0x00000001dc189120 0x1dc187000 + 8480
5   libobjc.A.dylib                   0x00000001dc1a1e48 0x1dc19b000 + 28232
6   libc++abi.dylib                   0x00000001dc1950fc 0x1dc187000 + 57596
7   libc++abi.dylib                   0x00000001dc195188 0x1dc187000 + 57736
8   libdispatch.dylib                 0x00000001dca0a498 0x1dc9a9000 + 398488
9   libdispatch.dylib                 0x00000001dc9e13f0 0x1dc9a9000 + 230384
10  FrontBoardServices                0x00000001dfa43a9c 0x1df9f8000 + 309916
11  FrontBoardServices                0x00000001dfa43728 0x1df9f8000 + 309032
12  FrontBoardServices                0x00000001dfa43d44 0x1df9f8000 + 310596
13  CoreFoundation                    0x00000001dcf601cc 0x1dceb4000 + 704972
14  CoreFoundation                    0x00000001dcf6014c 0x1dceb4000 + 704844
15  CoreFoundation                    0x00000001dcf5fa30 0x1dceb4000 + 703024
16  CoreFoundation                    0x00000001dcf5a8fc 0x1dceb4000 + 682236
17  CoreFoundation                    0x00000001dcf5a1cc 0x1dceb4000 + 680396
18  GraphicsServices                  0x00000001df1d1584 0x1df1c6000 + 46468
19  UIKitCore                         0x0000000209fe3328 0x2096fc000 + 9335592
20  wspxDemo                          0x0000000102cebaf0 0x102ce4000 + 31472
21  libdyld.dylib                     0x00000001dca1abb4 0x1dca1a000 + 2996

Thread 1:
0   libsystem_pthread.dylib           0x00000001dcbeece8 0x1dcbe0000 + 60648

Thread 2:
0   libsystem_pthread.dylib           0x00000001dcbeece8 0x1dcbe0000 + 60648

Thread 3:
0   libsystem_pthread.dylib           0x00000001dcbeece8 0x1dcbe0000 + 60648

Thread 4:
0   libsystem_pthread.dylib           0x00000001dcbeece8 0x1dcbe0000 + 60648

Thread 5 name:  com.apple.uikit.eventfetch-thread
Thread 5:
0   libsystem_kernel.dylib            0x00000001dcb5bed0 0x1dcb44000 + 98000
1   libsystem_kernel.dylib            0x00000001dcb5b3a8 0x1dcb44000 + 95144
2   CoreFoundation                    0x00000001dcf5fbc4 0x1dceb4000 + 703428
3   CoreFoundation                    0x00000001dcf5aa60 0x1dceb4000 + 682592
4   CoreFoundation                    0x00000001dcf5a1cc 0x1dceb4000 + 680396
5   Foundation                        0x00000001dd94f404 0x1dd947000 + 33796
6   Foundation                        0x00000001dd94f2b0 0x1dd947000 + 33456
7   UIKitCore                         0x000000020a0d0430 0x2096fc000 + 10306608
8   Foundation                        0x00000001dda821ac 0x1dd947000 + 1290668
9   libsystem_pthread.dylib           0x00000001dcbeb2ac 0x1dcbe0000 + 45740
10  libsystem_pthread.dylib           0x00000001dcbeb20c 0x1dcbe0000 + 45580
11  libsystem_pthread.dylib           0x00000001dcbeecf4 0x1dcbe0000 + 60660

Thread 0 crashed with ARM Thread State (64-bit):
    x0: 0x0000000000000000   x1: 0x0000000000000000   x2: 0x0000000000000000   x3: 0x000000028248b4b7
    x4: 0x00000001dc198b81   x5: 0x000000016d11a570   x6: 0x000000000000006e   x7: 0xffffffff00000500
    x8: 0x0000000000000800   x9: 0x00000001dcbe6870  x10: 0x00000001dcbe1ef4  x11: 0x0000000000000003
   x12: 0x0000000000000069  x13: 0x0000000000000000  x14: 0x0000000000000010  x15: 0x0000000000000016
   x16: 0x0000000000000148  x17: 0x0000000000000000  x18: 0x0000000000000000  x19: 0x0000000000000006
   x20: 0x00000001030aeb80  x21: 0x000000016d11a570  x22: 0x0000000000000303  x23: 0x00000001030aec60
   x24: 0x0000000000001903  x25: 0x0000000000002103  x26: 0x0000000000000000  x27: 0x0000000000000000
   x28: 0x00000002836bc408   fp: 0x000000016d11a4d0   lr: 0x00000001dcbe6998
    sp: 0x000000016d11a4a0   pc: 0x00000001dcb67104 cpsr: 0x00000000

Binary Images:
0x102ce4000 - 0x102ceffff wspxDemo arm64  &lt;b0ffd72fc5c33a59bf97c79556430202&gt; /var/containers/Bundle/Application/DF7AAB28-9FF0-99EC-4EA1-16B5C50EB87C/wspxDemo.app/wspxDemo
</code></pre></li>
<li><p>从<code>Binary Images:
0x102ce4000 - 0x102ceffff wspxDemo arm64  &lt;b0ffd72fc5c33a59bf97c79556430202&gt; /var/containers/Bundle/Application/DF7AAB28-9FF0-99EC-4EA1-16B5C50EB87C/wspxDemo.app/wspxDemo</code>中我们拿到<code>b0ffd72fc5c33a59bf97c79556430202</code></p>
</li>
<li><p>在终端执行<code>dwarfdump --uuid wspxDemo.app.dSYM/</code>后得到如下的输出:</p>
<pre><code>Mero:wspxDemo 2018-11-05 12-56-20 dc$ dwarfdump --uuid wspxDemo.app.dSYM/
UUID: 43C734F8-405F-3970-8B8D-D58575672912 (armv7) wspxDemo.app.dSYM/Contents/Resources/DWARF/wspxDemo
UUID: B0FFD72F-C5C3-3A59-BF97-C79556430202 (arm64) wspxDemo.app.dSYM/Contents/Resources/DWARF/wspxDemo
</code></pre></li>
<li><p>对比步骤2和3的结果会发现:<code>b0ffd72fc5c33a59bf97c79556430202</code>和<code>B0FFD72F-C5C3-3A59-BF97-C79556430202</code>是一致的，所以该<code>wspxDemo  2018-11-5, 2-42 PM.crash.crash</code>对应的<code>dysm</code>就是<code>wspxDemo.app.dSYM</code></p>
</li>
<li><p>在终端执行命令：<code>./symbolicatecrash wspxDemo\ \ 2018-11-5\,\ 2-42\ PM.crash wspxDemo.app.dSYM/ &gt; output.crash</code>得到如下的输出:</p>
<pre><code>Mero:wspxDemo 2018-11-05 12-56-20 dc$ ./symbolicatecrash wspxDemo\ \ 2018-11-5\,\ 2-42\ PM.crash wspxDemo.app.dSYM/ &gt; output.crash
Error: &quot;DEVELOPER_DIR&quot; is not defined at ./symbolicatecrash line 69.
</code></pre></li>
<li><p>报错:<code>Error: &quot;DEVELOPER_DIR&quot; is not defined at ./symbolicatecrash line 69.</code></p>
</li>
<li><p>执行如下命令:<code>export DEVELOPER_DIR=&quot;/Applications/XCode.app/Contents/Developer&quot;</code>然后再执行<code>5</code>的命令.执行结果如下:</p>
<pre><code>Mero:wspxDemo 2018-11-05 12-56-20 dc$ export DEVELOPER_DIR=&quot;/Applications/XCode.app/Contents/Developer&quot;
Mero:wspxDemo 2018-11-05 12-56-20 dc$ ./symbolicatecrash wspxDemo\ \ 2018-11-5\,\ 2-42\ PM.crash wspxDemo.app.dSYM/ &gt; output.crash
</code></pre></li>
<li><p>如果没有报任何其他错误，则说明你已经成功把<code>crash</code>符号了，这时打开<code>output.crash</code>开始查看崩溃堆栈吧</p>
</li>
<li><p>如下是符号化后的<code>output.crash</code>文件的内容:</p>
<pre><code>Incident Identifier: 211AB31B-F097-47DC-83ED-3AC6B3AC6B05
CrashReporter Key:   991d9b4c57cf7b9c00c2cabc05f20cb4812ea851
Hardware Model:      iPhone10,3
Process:             wspxDemo [1214]
Path:                /private/var/containers/Bundle/Application/DF7AAB28-9FF0-99EC-4EA1-16B5C50EB87C/wspxDemo.app/wspxDemo
Identifier:          com.crash.CrashMe
Version:             2222 (22.22.222)
Code Type:           ARM-64 (Native)
Role:                Foreground
Parent Process:      launchd [1]
Coalition:           com.crash.CrashMe [738]

Date/Time:           2018-11-05 14:42:17.6018 +0800
Launch Time:         2018-11-05 14:42:17.3303 +0800
OS Version:          iPhone OS 12.1 (16B5089b)
Baseband Version:    3.11.00
Report Version:      104

Exception Type:  EXC_CRASH (SIGABRT)
Exception Codes: 0x0000000000000000, 0x0000000000000000
Exception Note:  EXC_CORPSE_NOTIFY
Triggered by Thread:  0

Application Specific Information:
abort() called

Last Exception Backtrace:
0   CoreFoundation                    0x1dcfcfea0 __exceptionPreprocess + 228
1   libobjc.A.dylib                   0x1dc1a1a40 objc_exception_throw + 55
2   CoreFoundation                    0x1dcede054 -[__NSSingleObjectArrayI objectAtIndex:] + 127
3   wspxDemo                          0x102ceb9b4 -[AppDelegate application:didFinishLaunchingWithOptions:] + 31156 (AppDelegate.m:150)
4   UIKitCore                         0x209fda3c8 -[UIApplication _handleDelegateCallbacksWithOptions:isSuspended:restoreState:] + 411
5   UIKitCore                         0x209fdbb30 -[UIApplication _callInitializationDelegatesForMainScene:transitionContext:] + 3339
6   UIKitCore                         0x209fe157c -[UIApplication _runWithMainScene:transitionContext:completion:] + 1551
7   UIKitCore                         0x20987ea18 __111-[__UICanvasLifecycleMonitor_Compatability _scheduleFirstCommitForScene:transition:firstActivation:completion:]_block_invoke + 783
8   UIKitCore                         0x209887698 +[_UICanvas _enqueuePostSettingUpdateTransactionBlock:] + 159
9   UIKitCore                         0x20987e694 -[__UICanvasLifecycleMonitor_Compatability _scheduleFirstCommitForScene:transition:firstActivation:completion:] + 239
10  UIKitCore                         0x20987f034 -[__UICanvasLifecycleMonitor_Compatability activateEventsOnly:withContext:completion:] + 1075
11  UIKitCore                         0x20987d134 __82-[_UIApplicationCanvas _transitionLifecycleStateWithTransitionContext:completion:]_block_invoke + 771
12  UIKitCore                         0x20987cde0 -[_UIApplicationCanvas _transitionLifecycleStateWithTransitionContext:completion:] + 431
13  UIKitCore                         0x209881fa0 __125-[_UICanvasLifecycleSettingsDiffAction performActionsForCanvas:withUpdatedScene:settingsDiff:fromSettings:transitionContext:]_block_invoke + 219
14  UIKitCore                         0x209882f00 _performActionsWithDelayForTransitionContext + 111
15  UIKitCore                         0x209881e58 -[_UICanvasLifecycleSettingsDiffAction performActionsForCanvas:withUpdatedScene:settingsDiff:fromSettings:transitionContext:] + 247
16  UIKitCore                         0x209886d44 -[_UICanvas scene:didUpdateWithDiff:transitionContext:completion:] + 367
17  UIKitCore                         0x209fdfa74 -[UIApplication workspace:didCreateScene:withTransitionContext:completion:] + 539
18  UIKitCore                         0x209bca088 -[UIApplicationSceneClientAgent scene:didInitializeWithEvent:completion:] + 363
19  FrontBoardServices                0x1dfa049d4 -[FBSSceneImpl _didCreateWithTransitionContext:completion:] + 443
20  FrontBoardServices                0x1dfa0f79c __56-[FBSWorkspace client:handleCreateScene:withCompletion:]_block_invoke_2 + 259
21  FrontBoardServices                0x1dfa0ee94 __40-[FBSWorkspace _performDelegateCallOut:]_block_invoke + 63
22  libdispatch.dylib                 0x1dca0a484 _dispatch_client_callout + 15
23  libdispatch.dylib                 0x1dc9e13f0 _dispatch_block_invoke_direct$VARIANT$armv81 + 215
24  FrontBoardServices                0x1dfa43a9c __FBSSERIALQUEUE_IS_CALLING_OUT_TO_A_BLOCK__ + 39
25  FrontBoardServices                0x1dfa43728 -[FBSSerialQueue \_performNext] + 415
26  FrontBoardServices                0x1dfa43d44 -[FBSSerialQueue \_performNextFromRunLoopSource] + 55
27  CoreFoundation                    0x1dcf601cc __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 23
28  CoreFoundation                    0x1dcf6014c __CFRunLoopDoSource0 + 87
29  CoreFoundation                    0x1dcf5fa30 __CFRunLoopDoSources0 + 175
30  CoreFoundation                    0x1dcf5a8fc __CFRunLoopRun + 1039
31  CoreFoundation                    0x1dcf5a1cc CFRunLoopRunSpecific + 435
32  GraphicsServices                  0x1df1d1584 GSEventRunModal + 99
33  UIKitCore                         0x209fe3328 UIApplicationMain + 211
34  wspxDemo                          0x102cebaf0 main + 31472 (main.m:14)
35  libdyld.dylib                     0x1dca1abb4 start + 3

Thread 0 name:  Dispatch queue: com.apple.main-thread
Thread 0 Crashed:
0   libsystem_kernel.dylib            0x00000001dcb67104 __pthread_kill + 8
1   libsystem_pthread.dylib           0x00000001dcbe6998 pthread_kill$VARIANT$armv81 + 296
2   libsystem_c.dylib                 0x00000001dcabed78 abort + 140
3   libc++abi.dylib                   0x00000001dc188f78 __cxa_bad_cast + 0
4   libc++abi.dylib                   0x00000001dc189120 default_unexpected_handler+ 8480 () + 0
5   libobjc.A.dylib                   0x00000001dc1a1e48 _objc_terminate+ 28232 () + 124
6   libc++abi.dylib                   0x00000001dc1950fc std::__terminate(void (*)+ 57596 ()) + 16
7   libc++abi.dylib                   0x00000001dc195188 std::terminate+ 57736 () + 84
8   libdispatch.dylib                 0x00000001dca0a498 _dispatch_client_callout + 36
9   libdispatch.dylib                 0x00000001dc9e13f0 _dispatch_block_invoke_direct$VARIANT$armv81 + 216
10  FrontBoardServices                0x00000001dfa43a9c __FBSSERIALQUEUE_IS_CALLING_OUT_TO_A_BLOCK__ + 40
11  FrontBoardServices                0x00000001dfa43728 -[FBSSerialQueue _performNext] + 416
12  FrontBoardServices                0x00000001dfa43d44 -[FBSSerialQueue _performNextFromRunLoopSource] + 56
13  CoreFoundation                    0x00000001dcf601cc __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24
14  CoreFoundation                    0x00000001dcf6014c __CFRunLoopDoSource0 + 88
15  CoreFoundation                    0x00000001dcf5fa30 __CFRunLoopDoSources0 + 176
16  CoreFoundation                    0x00000001dcf5a8fc __CFRunLoopRun + 1040
17  CoreFoundation                    0x00000001dcf5a1cc CFRunLoopRunSpecific + 436
18  GraphicsServices                  0x00000001df1d1584 GSEventRunModal + 100
19  UIKitCore                         0x0000000209fe3328 UIApplicationMain + 212
20  wspxDemo                          0x0000000102cebaf0 main + 31472 (main.m:14)
21  libdyld.dylib                     0x00000001dca1abb4 start + 4

Thread 1:
0   libsystem_pthread.dylib           0x00000001dcbeece8 start_wqthread + 0

Thread 2:
0   libsystem_pthread.dylib           0x00000001dcbeece8 start_wqthread + 0

Thread 3:
0   libsystem_pthread.dylib           0x00000001dcbeece8 start_wqthread + 0

Thread 4:
0   libsystem_pthread.dylib           0x00000001dcbeece8 start_wqthread + 0

Thread 5 name:  com.apple.uikit.eventfetch-thread
Thread 5:
0   libsystem_kernel.dylib            0x00000001dcb5bed0 mach_msg_trap + 8
1   libsystem_kernel.dylib            0x00000001dcb5b3a8 mach_msg + 72
2   CoreFoundation                    0x00000001dcf5fbc4 __CFRunLoopServiceMachPort + 236
3   CoreFoundation                    0x00000001dcf5aa60 __CFRunLoopRun + 1396
4   CoreFoundation                    0x00000001dcf5a1cc CFRunLoopRunSpecific + 436
5   Foundation                        0x00000001dd94f404 -[NSRunLoop+ 33796 (NSRunLoop) runMode:beforeDate:] + 300
6   Foundation                        0x00000001dd94f2b0 -[NSRunLoop+ 33456 (NSRunLoop) runUntilDate:] + 148
7   UIKitCore                         0x000000020a0d0430 -[UIEventFetcher threadMain] + 136
8   Foundation                        0x00000001dda821ac __NSThread__start__ + 1040
9   libsystem_pthread.dylib           0x00000001dcbeb2ac \_pthread_body + 128
10  libsystem_pthread.dylib           0x00000001dcbeb20c \_pthread_start + 48
11  libsystem_pthread.dylib           0x00000001dcbeecf4 thread_start + 4

Thread 0 crashed with ARM Thread State (64-bit):
x0: 0x0000000000000000   x1: 0x0000000000000000   x2: 0x0000000000000000   x3: 0x000000028248b4b7
x4: 0x00000001dc198b81   x5: 0x000000016d11a570   x6: 0x000000000000006e   x7: 0xffffffff00000500
x8: 0x0000000000000800   x9: 0x00000001dcbe6870  x10: 0x00000001dcbe1ef4  x11: 0x0000000000000003
x12: 0x0000000000000069  x13: 0x0000000000000000  x14: 0x0000000000000010  x15: 0x0000000000000016
x16: 0x0000000000000148  x17: 0x0000000000000000  x18: 0x0000000000000000  x19: 0x0000000000000006
x20: 0x00000001030aeb80  x21: 0x000000016d11a570  x22: 0x0000000000000303  x23: 0x00000001030aec60
x24: 0x0000000000001903  x25: 0x0000000000002103  x26: 0x0000000000000000  x27: 0x0000000000000000
x28: 0x00000002836bc408   fp: 0x000000016d11a4d0   lr: 0x00000001dcbe6998
sp: 0x000000016d11a4a0   pc: 0x00000001dcb67104 cpsr: 0x00000000

Binary Images:
0x102ce4000 - 0x102ceffff wspxDemo arm64  &lt;b0ffd72fc5c33a59bf97c79556430202&gt; /var/containers/Bundle/Application/DF7AAB28-9FF0-99EC-4EA1-16B5C50EB87C/wspxDemo.app/wspxDemo
</code></pre></li>
<li>从<code>crash</code>文件中我们很容易定位到<code>app</code>挂在了<code>AppDelegate.m</code>文件中的<code>第150行</code>这里.并且可能是因为数组越界导致崩溃。从源码截图中看确实是在<code>AppDelegate.m</code>的<code>150行</code>有问题.</li>
<li>得到符号化<code>crash</code>文件后就可以进一步排查问题，之前有写过相关的博客<a href="https://mrchens.github.io/2018/07/26/debug-with-crashlog">传送门</a>在这里就不再详细说明.</li>
</ol>
<p>  <img src="https://github.com/MrChens/iOS_Tools/blob/master/crashMe/sourcecode.png" alt="源码"></p>
<h1 id="nextDay"><a href="#nextDay" class="headerlink" title="nextDay"></a>nextDay</h1><p>  <a href="https://github.com/MrChens/iOS_Tools/tree/master/nextDay" target="_blank" rel="noopener">传送门</a></p>

      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechat_qrcode.jpg" alt="Zerlz wechat" style="width: 200px; max-width: 100%;"/>
    <div>扫码关注一个很懒的程序员!</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Winter is coming, give me a penny!</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat_reward.JPG" alt="Zerlz WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay_reward.jpg" alt="Zerlz Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Zerlz</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://mrchens.github.io/2017/04/17/iOS-Tools/" title="iOS工具集">https://mrchens.github.io/2017/04/17/iOS-Tools/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/27/2016-year-end-report/" rel="next" title="2016年终总结">
                <i class="fa fa-chevron-left"></i> 2016年终总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/05/mitmproxy-for-iOS-app-usage/" rel="prev" title="mitmproxy for iOS app usage">
                mitmproxy for iOS app usage <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Zerlz" />
            
              <p class="site-author-name" itemprop="name">Zerlz</p>
              <p class="site-description motion-element" itemprop="description">It’s amazing how the unexpected, can take your life and change directions.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/MrChens" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/LableTag" target="_blank" title="Twitter" rel="external nofollow"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/325751212" target="_blank" title="Weibo" rel="external nofollow"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#codeObfuscated"><span class="nav-number">1.</span> <span class="nav-text">codeObfuscated</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本工具是用于混淆方法名和类名"><span class="nav-number">1.1.</span> <span class="nav-text">本工具是用于混淆方法名和类名</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用步骤"><span class="nav-number">1.1.1.</span> <span class="nav-text">使用步骤:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#aUtoReSiGn"><span class="nav-number">2.</span> <span class="nav-text">aUtoReSiGn</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-环境要求"><span class="nav-number">2.1.</span> <span class="nav-text">1. 环境要求:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-使用方式"><span class="nav-number">2.2.</span> <span class="nav-text">2. 使用方式:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-重要的"><span class="nav-number">2.3.</span> <span class="nav-text">3. 重要的:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Development配置"><span class="nav-number">2.4.</span> <span class="nav-text">3.1 Development配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Distribution配置"><span class="nav-number">2.5.</span> <span class="nav-text">3.1 Distribution配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-如何修改对应的Entitlements-plist"><span class="nav-number">2.6.</span> <span class="nav-text">3.2 如何修改对应的Entitlements.plist</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-如何获取对应的xx-mobileprovision"><span class="nav-number">2.7.</span> <span class="nav-text">3.3 如何获取对应的xx.mobileprovision</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-如何获取您证书的名字"><span class="nav-number">2.8.</span> <span class="nav-text">3.4 如何获取您证书的名字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如果不想使用自动重签名，可以将xx-ipa放在resign目录下-并执行脚本resign-sh"><span class="nav-number">2.9.</span> <span class="nav-text">如果不想使用自动重签名，可以将xx.ipa放在resign目录下,并执行脚本resign.sh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件结构"><span class="nav-number">2.10.</span> <span class="nav-text">文件结构:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#inject-with-jailbreaking"><span class="nav-number">3.</span> <span class="nav-text">inject_with_jailbreaking</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#有空的时候补充一下文档，可以先从传送门过去看看"><span class="nav-number">3.1.</span> <span class="nav-text">有空的时候补充一下文档，可以先从传送门过去看看.</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#class-dump"><span class="nav-number">4.</span> <span class="nav-text">class_dump</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#导出头文件操作流程文档"><span class="nav-number">4.1.</span> <span class="nav-text">导出头文件操作流程文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#砸壳时遇见如下"><span class="nav-number">4.2.</span> <span class="nav-text">砸壳时遇见如下</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。"><span class="nav-number">4.3.</span> <span class="nav-text">本目录下已经预先放置好了需要使用的工具，如果不能使用请从上面的网址去download新的工具来。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#针对App-Store下载的ipa进行的class-dump-需要越狱的设备"><span class="nav-number">4.4.</span> <span class="nav-text">针对App Store下载的ipa进行的class-dump(需要越狱的设备)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#针对不需要砸壳的ipa进行的class-dump-不需要越狱的设备"><span class="nav-number">4.5.</span> <span class="nav-text">针对不需要砸壳的ipa进行的class-dump(不需要越狱的设备)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#B-amp-A-amp-D"><span class="nav-number">5.</span> <span class="nav-text">B&amp;A&amp;D</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#环境要求"><span class="nav-number">5.1.</span> <span class="nav-text">环境要求:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用方式"><span class="nav-number">5.2.</span> <span class="nav-text">使用方式:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#isWKoUI"><span class="nav-number">6.</span> <span class="nav-text">isWKoUI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview"><span class="nav-number">6.1.</span> <span class="nav-text">如何通过Safari检测第三方app的某个页面是WKWebview还是UIWebview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用方法"><span class="nav-number">6.2.</span> <span class="nav-text">使用方法:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trick"><span class="nav-number">6.3.</span> <span class="nav-text">Trick</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TODO"><span class="nav-number">6.4.</span> <span class="nav-text">TODO:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#crashMe"><span class="nav-number">7.</span> <span class="nav-text">crashMe</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#app崩溃时排查步骤"><span class="nav-number">7.1.</span> <span class="nav-text">app崩溃时排查步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需要的工具"><span class="nav-number">7.2.</span> <span class="nav-text">需要的工具:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用方式-1"><span class="nav-number">7.3.</span> <span class="nav-text">使用方式:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实际操作"><span class="nav-number">7.4.</span> <span class="nav-text">实际操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nextDay"><span class="nav-number">8.</span> <span class="nav-text">nextDay</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zerlz</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Gemini</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://mrchens.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://mrchens.github.io/2017/04/17/iOS-Tools/';
        this.page.identifier = '2017/04/17/iOS-Tools/';
        this.page.title = 'iOS工具集';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://mrchens.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("Rbmck7R3KAm9W7niGDdiqynV-gzGzoHsz", "vkjMmth4lwiUrDQ7gMeA9MkM");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  

  

</body>
</html>
